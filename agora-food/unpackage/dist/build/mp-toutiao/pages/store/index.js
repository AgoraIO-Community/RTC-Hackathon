(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/store/index"],{"039f":function(t,o,e){"use strict";(function(t){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var r=n(e("ebb05"));function n(t){return t&&t.__esModule?t:{default:t}}var i=function(){return Promise.all([e.e("common/vendor"),e.e("components/uni-icons/uni-icons")]).then(e.bind(null,"e406"))},a=function(){return e.e("components/hx-navbar/hx-navbar").then(e.bind(null,"1197"))},s=function(){return e.e("components/hx-jump-ball/hx-jump-ball").then(e.bind(null,"ec31"))},c=function(){return e.e("components/uni-number-box/uni-number-box").then(e.bind(null,"1575"))},u=function(){return e.e("components/hx-comment/hx-comment").then(e.bind(null,"6bbf"))},h=function(){return e.e("components/hx-preview-img/hx-preview-img").then(e.bind(null,"1d74"))},d=t.getSystemInfoSync().statusBarHeight,l={components:{jumpBall:s,hxNavbar:a,uniIcons:i,hxNumberBox:c,hxComment:u,hxPreviewImg:h},data:function(){return{pageScroll:{},storeData:[],goodsList:[],categoryList:[],commentList:[],navSearchWidth:3,navSearchBgOpacity:0,navSearchColor:"#ffffff",navHeadHeight:44,goodsBoxScroll:!1,statusBarHeight:d,animaTime:300,storeInfoBoxHeight:100,showStoreBox:!1,num:1,element:[],cartAnimation:{},cartAnimationData:{},tabs:[{name:"购物"},{name:"评价"},{name:"商家"}],swiperCurrent:0,dx:0,swiperCurrentSliderLeft:0,transtionTime:100,shoppingCartAll:[],showFoot:!0,shippingDees:0,startingPrice:0,goodsTotalPrice:0,goodsTotalNumber:0,shoppCart:[],footHeight:"0",showCar:!1,carGoodsScrollTop:0,shoppingCartStorageName:"shopping_cart",sizeCalcState:!1,tabScrollTop:0,mainHeight:0,currentId:1,showDiscount:!0,touchData:{},pageScrollTop:0,currentGoodsData:{},showFormBox:!1,formAnimationData:{},currentImg:"",previewImgList:[],PINum:0,previewImgStatus:!1,navStatus:!0}},onLoad:function(o){var e=t.getSystemInfoSync();this.mainHeight=e.screenHeight-43-d-40+"px"},onBackPress:function(t){return this.showFormBox?(this.hiddenForm(),!0):this.previewImgStatus?(this.PINum=0,!0):void 0},mounted:function(){var o=this;t.showLoading({title:"加载中"}),setTimeout(function(){o.storeData=r.default.storeData,o.goodsList=r.default.goodsData,o.categoryList=r.default.categoryData,o.commentList=r.default.commentData,setTimeout(function(){o.init(),t.hideLoading()},200)},500)},watch:{showStoreBox:function(t,o){1==t?this.showStoreBoxFunc():this.hiddenStoreBoxFunc()}},onPageScroll:function(o){var e=this,r=o.scrollTop;if(e.pageScrollTop=o.scrollTop,e.pageScroll=o,r<120){if(e.navSearchWidth>=3)if(r<3)e.navSearchWidth=3,e.navSearchBgOpacity=0,e.navSearchColor="#ffffff";else{var n=1.2*r;n>100&&(n=100),e.navSearchWidth=n,e.navSearchBgOpacity=.01*r,e.navSearchColor="#888888"}}else e.navSearchWidth=100,e.navSearchBgOpacity=1,e.navSearchColor="#888888";var i=t.createSelectorQuery().select(".main");i.fields({rect:!0},function(t){null!=t&&(t.top<=d+44?e.goodsBoxScroll=!0:e.goodsBoxScroll=!1)}).exec()},methods:{init:function(){var o=this,e=this.goodsList;for(var r in e)e[r].purchases=3;var n=t.getStorageSync(o.shoppingCartStorageName)||[];for(var i in n)if(n[i].store_id==o.storeData.store_id){o.shoppCart=n[i].shopping_cart?n[i].shopping_cart:[];break}for(var a in o.shoppCart){for(var s in e)e[s].id==o.shoppCart[a].id&&(e[s].number=o.shoppCart[a].number);o.goodsTotalPrice+=o.shoppCart[a].total,o.goodsTotalNumber+=o.shoppCart[a].number}o.goodsList=e,o.starting_price=o.storeData.starting_price,o.shipping_dees=o.storeData.shipping_dees,o.setLabelNumber(),this.calcSize()},navBack:function(){getCurrentPages().length>1?t.navigateBack():t.reLaunch({url:"/pages/index/index"})},showForm:function(o){var e=this,r=e.getStoreCart();if(r){var n=null;for(var i in r)if(r[i].id==o.id){n=r[i];break}if(n){var a=!1;for(var s in o.form_child)o.form_child[s].id==n.current_form.id?a?o.form_child[s].select=!1:(o.form_child[s].select=!0,o.number=n.number,a=!0):o.form_child[s].select=!1}}var c=t.createAnimation({timingFunction:"ease"});e.currentGoodsData=o,e.animation=c,c.top(0).bottom(0).left(0).right(0).step({duration:0}),c.opacity(1).step({duration:300}),e.formAnimationData=c.export(),e.showFormBox=!0},hiddenForm:function(){var o=t.createAnimation({timingFunction:"ease"});this.animation=o,o.scale(0,0).opacity(0).step({duration:300}),o.top(0).bottom(0).left("-100%").right("100%").step({duration:0}),this.formAnimationData=o.export();var e=this;e.showFormBox=!1},formFirstAddGoods:function(){var t=this;t.formAddGoodsChange(1,t.currentGoodsData),t.touchOnAddGoods("#ggAddBtn",t.currentGoodsData)},formAddGoodsChange:function(t,o){var e=this;if(t>=1)for(var r in o.form_child)if(1==o.form_child[r].select){e.currentGoodsData.current_form=o.form_child[r];break}e.addGoodsChange(t,e.currentGoodsData)},selectGoodsForm:function(t,o){var e=this,r=t.form_child,n=0;for(var i in r)r[i].id==o.id?r[i].select=!0:r[i].select=!1;var a=e.getStoreCart();if(a)for(var s in a)if(a[s].id==t.id&&a[s].current_form.id==o.id){n=a[s].number;break}t.number=n,this.currentGoodsData=t},getCartGoodsNum:function(t){var o=this.getStoreCart(),e=0;if(o)for(var r in o)o[r].id==t.id&&(e+=o[r].number);return e},getStoreCart:function(){var o=this,e={},r=t.getStorageSync(o.shoppingCartStorageName)||[];if(r){for(var n in r)if(r[n].store_id==o.storeData.store_id){e=r[n].shopping_cart?r[n].shopping_cart:[];break}}else o.storeData.shopping_cart=[],t.setStorageSync(o.shoppingCartStorageName,o.storeData);return e},commentPreviewImg:function(t){},previewImg:function(t,o){this.currentImg=t,this.previewImgList=o,this.PINum++},previewImgChange:function(t){this.previewImgStatus=t},jbMsg:function(t){t.status},swiperChange:function(t){this.swiperCurrent=t,this.swiperCurrentSliderLeft=70*t},transition:function(t){t.detail.dx},animationfinish:function(t){var o=t.detail.current;this.swiperCurrent=o,this.current=o,this.swiperChange(o),this.showFoot=0==o&&1!=this.showStoreBox},showCategory:function(t){this.calcSize(),this.currentId=t.id;var o=this.categoryList.findIndex(function(o){return o.id===t.id});this.tabScrollTop=this.categoryList[o].top},asideScroll:function(t){this.calcSize();var o=Math.round(t.detail.scrollTop),e=this.categoryList.filter(function(t){return t.top<=o}).reverse();e.length>0&&(this.currentId=e[0].id)},calcSize:function(o){var e=0;this.categoryList.forEach(function(o){var r=t.createSelectorQuery().select("#goodsBox"+o.id);r.fields({size:!0},function(t){null!=t&&(o.top=e,e+=Math.round(t.height),o.bottom=e)}).exec()}),this.sizeCalcState=!0},touchOnAddGoods:function(t,o){this.element=[t,".cart"],this.num++},addGoodsChange:function(o,e){o=Number(o);var r=this,n=[],i=0,a=0,s=!1,c=!0,u=!1;e.current_form&&(u=!0);var h=null,d=t.getStorageSync(r.shoppingCartStorageName)||[];if(0!=d.length){for(var l in c=!1,d)if(d[l].store_id==r.storeData.store_id){n=d[l].shopping_cart?d[l].shopping_cart:[];break}for(var f in n)if(n[f].id==e.id&&(u?n[f].current_form.id==e.current_form.id&&(s=!0):s=!0,s)){if(o<=0){h=n[f];break}u?(n[f].price=e.current_form.price,n[f].oldprice=e.current_form.oldprice,n[f].total=o*e.current_form.price):(n[f].price=e.price,n[f].total=o*e.price,n[f].oldprice=e.oldprice),n[f].number=e.number=o;break}}if(null==h){for(var f in s||(e.form?(e.price=e.current_form.price,e.oldprice=e.current_form.oldprice,e.total=o*e.current_form.price):e.total=o*e.price,e.number=o,n.push(e)),n)i+=n[f].total,a+=n[f].number;for(var p in r.goodsList)if(r.goodsList[p].id==e.id){r.goodsList[p]=e;break}r.goodsTotalPrice,r.goodsTotalPrice=i,r.goodsTotalNumber=a,r.shoppCart=n,r.storeData.shopping_cart=n,r.setLabelNumber(),c&&d.push(r.storeData),0==r.goodsTotalNumber&&r.hideShoppingCar(),t.setStorageSync(r.shoppingCartStorageName,d)}else if(d){for(var g in d)if(d[g].store_id==r.storeData.store_id){var m=n.indexOf(h);for(var v in m>-1&&n.splice(m,1),d[g].shopping_cart=n,n)i+=n[v].total,a+=n[v].number;for(var S in r.goodsList)if(r.goodsList[S].id==e.id){r.goodsList[S]=e;break}r.goodsTotalPrice=i,r.goodsTotalNumber=a,r.shoppCart=n,r.shoppingCartAll=d,r.setLabelNumber(),t.setStorageSync(r.shoppingCartStorageName,d);break}}else r.storeData.shopping_cart=[],t.setStorageSync(r.shoppingCartStorageName,r.storeData)},setLabelNumber:function(){var t=this;for(var o in t.categoryList){var e=0;for(var r in t.shoppCart)t.shoppCart[r].type_id==t.categoryList[o].id&&(e+=t.shoppCart[r].number);t.categoryList[o].number=e}},jiesuan:function(){this.navTo("/pages/order/preview?sid="+this.storeData.store_id)},navTo:function(o){var e=this;e.navStatus&&(e.navStatus=!1,t.navigateTo({url:o,complete:function(){e.navStatus=!0}}))},contact:function(){t.showModal({title:"",content:"联系商家"})},showStoreBoxFunc:function(){this.storeInfoBoxHeight=t.getSystemInfoSync().screenHeight-136,this.$set(this.$data,"showFoot",!1),this.showStoreBox=!0,t.pageScrollTo({duration:0,scrollTop:0})},hiddenStoreBoxFunc:function(){this.storeInfoBoxHeight=100,this.showStoreBox=!1,0==this.swiperCurrent&&this.$set(this.$data,"showFoot",!0)},mpClear:function(t){t.stopPropagation()},showShoppingCar:function(){0!=this.goodsTotalNumber&&(this.footHeight="100%",this.showCar=!0,this.carGoodsScrollTop=0)},hideShoppingCar:function(){this.footHeight="0",this.showCar=!1},clearShoppingCart:function(){var o=this;for(var e in o.shoppCart=[],o.storeData.shopping_cart=[],o.shoppingCartAll)o.shoppingCartAll[e].store_id==o.storeData.store_id&&(o.shoppingCartAll[e]=o.storeData);for(var r in t.setStorageSync(o.shoppingCartStorageName,o.shoppingCartAll),o.goodsList)o.goodsList[r].number=0;for(var n in o.categoryList)o.categoryList[n].number=0;o.goodsTotalPrice=0,o.goodsTotalNumber=0,o.hideShoppingCar()},hrefGoodsInfo:function(t){this.navTo("/pages/product/product?id="+t)},goCall:function(o){o&&t.makePhoneCall({phoneNumber:o})},touchStart:function(t){this.touchData.clientX=t.changedTouches[0].clientX,this.touchData.clientY=t.changedTouches[0].clientY},touchEnd:function(t){t.changedTouches[0].clientX,this.touchData.clientX;var o=t.changedTouches[0].clientY-this.touchData.clientY;(o>50||o<-50)&&(o>50?this.pageScrollTop:o<-50&&(this.showStoreBox=!1))}}};o.default=l}).call(this,e("f266")["default"])},"1bad":function(t,o,e){},"6e17":function(t,o,e){"use strict";var r=e("1bad"),n=e.n(r);n.a},8589:function(t,o,e){"use strict";var r={"hx-navbar":()=>e.e("components/hx-navbar/hx-navbar").then(e.bind(null,"1197")),"hx-comment":()=>e.e("components/hx-comment/hx-comment").then(e.bind(null,"6bbf")),"hx-preview-img":()=>e.e("components/hx-preview-img/hx-preview-img").then(e.bind(null,"1d74"))},n=function(){var t=this,o=t.$createElement,e=(t._self._c,t.__map(t.categoryList,function(o,e){var r=t.__map(t.goodsList,function(o,e){var r=t.getCartGoodsNum(o),n=t.getCartGoodsNum(o);return{$orig:t.__get_orig(o),m0:r,m1:n}});return{$orig:t.__get_orig(o),l0:r}}));t._isMounted||(t.e0=function(o){t.showStoreBox=!t.showStoreBox}),t.$mp.data=Object.assign({},{$root:{l1:e}})},i=[];e.d(o,"b",function(){return n}),e.d(o,"c",function(){return i}),e.d(o,"a",function(){return r})},c76e:function(t,o,e){"use strict";e.r(o);var r=e("039f"),n=e.n(r);for(var i in r)"default"!==i&&function(t){e.d(o,t,function(){return r[t]})}(i);o["default"]=n.a},cf12:function(t,o,e){"use strict";e.r(o);var r=e("8589"),n=e("c76e");for(var i in n)"default"!==i&&function(t){e.d(o,t,function(){return n[t]})}(i);e("6e17");var a,s=e("f0c5"),c=Object(s["a"])(n["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],a);o["default"]=c.exports},f09e:function(t,o,e){"use strict";(function(t){e("e0ad"),e("921b");r(e("66fd"));var o=r(e("cf12"));function r(t){return t&&t.__esModule?t:{default:t}}t(o.default)}).call(this,e("f266")["createPage"])}},[["f09e","common/runtime","common/vendor"]]]);